const batch_draw=function(){let t="../../../data/Vaccine_Hesitancy.csv";draw_plot1(t),draw_plot2(t),draw_plot3("../../data/vaccine_rollout.csv"),draw_plot4(t),draw_plot5(t)};let draw_plot1=function(t){let e=t=>({SVI_index:parseFloat(t["Social Vulnerability Index (SVI)"]),estimated_hesitant:parseFloat(t["Estimated hesitant"]),estimated_strongly_hesitant:parseFloat(t["Estimated strongly hesitant"]),estimated_hesitant_unsure:parseFloat(t["Estimated hesitant or unsure"])});data=d3.csv(t,e),data.then(t=>{let e=800,a=800,r=60,n=d3.select("#plot1").append("svg").attr("width",a).attr("height",e),l=d3.scaleLinear().domain([-.02,1]).range([r,a-r]),s=d3.scaleLinear().domain([0,.35]).range([e-r,r]),i=d3.axisBottom().scale(l),o=d3.axisLeft().scale(s);n.append("g").call(i).attr("class","xAxis").attr("transform",`translate(0, ${e-r})`),n.append("g").call(o).attr("class","yAxis").attr("transform",`translate(${r}, 0)`);let d="estimated_hesitant_unsure",c=t.map(t=>[t.SVI_index,t[d]]),p=ss.linearRegression(c.slice(0,1e3));n.selectAll("circle").data(t).enter().append("circle").attr("class","dot").attr("cx",t=>l(t.SVI_index)).attr("cy",t=>s(t[d])).attr("r",3).attr("fill","plum").attr("opacity",.5);let y=ss.linearRegressionLine(p),x=[{x:0,y:y(0)},{x:1,y:y(1)}],h=d3.line().x(t=>l(t.x)).y(t=>s(t.y));n.append("path").datum(x).attr("d",h).attr("class","regression").style("stroke","hotpink").style("stroke-width",2),n.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",a/2).attr("y",e-20).attr("font-size",20).text("Social Vulnerability Index"),n.append("text").attr("class","y label").attr("text-anchor","middle").attr("x",-a/2).attr("y",10).attr("dy",".75em").attr("transform","rotate(-90)").attr("font-size",20).text("Vaccine Hesitancy Rating");let m=e=>{d=e.target.value,console.log(d),n.selectAll(".dot").attr("cy",t=>s(t[d]));let a=t.map(t=>[t.SVI_index,t[d]]),r=ss.linearRegression(a.slice(0,1e3)),i=ss.linearRegressionLine(r),o=[{x:0,y:i(0)},{x:1,y:i(1)}],c=d3.line().x(t=>l(t.x)).y(t=>s(t.y));n.select(".regression").datum(o).attr("d",c)};d3.select("#radio_plot1").on("change",m),n.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",a/2).attr("y",r-20).attr("font-size",20).text("Social Vulnerability is Positively Correlated with Vaccine Hesitancy Rating")})},draw_plot2=function(t){let e=t=>({state_code:t["State Code"],estimated_hesitant:parseFloat(t["Estimated hesitant"]),estimated_strongly_hesitant:parseFloat(t["Estimated strongly hesitant"]),estimated_hesitant_unsure:parseFloat(t["Estimated hesitant or unsure"])});d3.csv(t,e).then(t=>{function e(t,e){d3.select(this).transition("be pink").duration(50).style("fill","#e27c7c"),g.transition("Show tooltip").duration(200).style("opacity",.9),g.html(`State: ${e.state_code} <br> Hesitancy Rate: ${e[_].toFixed(2)}`).style("left",t.pageX+"px").style("top",t.pageY-45+"px")}function a(){d3.select(this).transition("be black").duration(500).style("fill","#503f3f"),g.transition("Show tooltip").duration(200).style("opacity",0)}function r(t){g.style("left",t.pageX+10+"px").style("top",t.pageY-50+"px")}let n=function(t){return t.reduce((t,e)=>({estimated_hesitant:t.estimated_hesitant+e.estimated_hesitant,estimated_strongly_hesitant:t.estimated_strongly_hesitant+e.estimated_strongly_hesitant,estimated_hesitant_unsure:t.estimated_hesitant_unsure+e.estimated_hesitant_unsure}))},l=d3.rollup(t,n,t=>t.state_code),s=d3.rollup(t,t=>t.length,t=>t.state_code),i=Array.from(l,([t,e])=>({name:t,...e}));i=i.map(t=>{let e=s.get(t.name);return{state_code:t.name,estimated_hesitant:t.estimated_hesitant/e,estimated_strongly_hesitant:t.estimated_strongly_hesitant/e,estimated_hesitant_unsure:t.estimated_hesitant_unsure/e}}),console.log(i);let o=i.map(t=>t.state_code).sort();console.log(o);let d=700,c=1e3,p=50,y=d3.select("#plot2").append("svg").attr("width",c).attr("height",d),x=d3.scaleBand().domain(o).range([p,c-p]).paddingInner(.15),h=d3.scaleLinear().domain([0,.35]).range([d-p,p]),m=d3.axisBottom().scale(x),u=d3.axisLeft().scale(h);y.append("g").call(m).attr("class","xAxis").attr("transform",`translate(0, ${d-p})`),y.append("g").call(u).attr("class","yAxis").attr("transform",`translate(${p}, 0)`);let g=d3.select("#plot2").append("div").style("opacity",0).attr("class","tooltip").style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px");y.selectAll(".bar").data(i).enter().append("rect").attr("class","bar").attr("x",(t,e)=>x(o[e])).attr("y",t=>h(t.estimated_hesitant_unsure)).attr("width",x.bandwidth()).attr("height",t=>d-h(t.estimated_hesitant_unsure)-p).style("fill","#503f3f").on("mouseover",e).on("mouseout",a).on("mousemove",r);y.append("text").attr("class","x label").attr("text-anchor","end").attr("x",c/2+50).attr("font-size",20).attr("y",d-10).text("State Code"),y.append("text").attr("class","y label").attr("text-anchor","end").attr("x",-300).attr("y",0).attr("font-size",20).attr("dy",".75em").attr("transform","rotate(-90)").text("Hesitancy Rate");let f=0,_="estimated_hesitant_unsure",b=(t,e)=>0===f?e[_]-t[_]:1===f?t[_]-e[_]:(f=-1,t.state_code.localeCompare(e.state_code)),V=function(){i.sort(b);let t=i.map(t=>t.state_code);x.domain(o),y.selectAll(".bar").sort(b).transition("sorting").duration(1e3).attr("x",(t,e)=>x(o[e])),x.domain(t),f++,console.log(i),y.select(".xAxis").transition().duration(1e3).call(m)};d3.select("#sort_button").on("click",function(){V()});let w=t=>{_=t.target.value,x.domain(o),y.selectAll(".bar").transition("change cat").duration(1e3).attr("x",(t,e)=>x(o[e])).attr("y",t=>h(t[_])).attr("height",t=>d-h(t[_])-p),f=0};d3.select("#radio_plot2").on("change",w),y.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",c/2).attr("y",p-20).attr("font-size",20).text("Explore Different States' Vaccination Hesitancy Rate")})},draw_plot3=function(t){let e=t=>{if("US"===t.Location)return{Date:new Date(t.Date),Total_Admin:parseInt(t.Administered),Janssen:parseInt(t.Administered_Janssen),Moderna:parseInt(t.Administered_Moderna),Pfizer:parseInt(t.Administered_Pfizer),Unknown:parseInt(t.Administered_Unk_Manuf)}};d3.csv(t,e).then(t=>{t=t.reverse(),console.log(t);let e=700,a=1200,r=90,n=d3.select("#plot3").append("svg").attr("width",a).attr("height",e),l=d3.scaleLinear().domain(d3.extent(t,function(t){return t.Date})).range([r,a-r]),s=d3.scaleLinear().domain([0,d3.max(t.map(t=>t.Total_Admin))]).range([e-r,r]);n.append("g").call(d3.axisBottom(l).tickFormat(t=>new Date(t).toISOString().split("T")[0])).attr("transform",`translate(0, ${e-r})`),n.append("g").call(d3.axisLeft(s)).attr("transform",`translate(${r},0)`);let i=["Janssen","Moderna","Pfizer","Unknown"],o=d3.scaleOrdinal().domain(i).range(["#7eb0d5","#bd7ebe","#8bd3c7","#b2e061"]),d=d3.stack().offset(d3.stackOffsetNone).keys(i)(t);console.log(d);d3.select("#plot2").append("div").style("opacity",0).attr("class","tooltip").style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px");let c=function(){d3.selectAll(".myArea").style("opacity",.2),d3.select(this).style("stroke","black").style("opacity",1)},p=function(){d3.selectAll(".myArea").style("opacity",1).style("stroke","none")};n.selectAll("streamGraph").data(d).enter().append("path").style("fill",(t,e)=>o(i[e])).attr("d",d3.area().x((e,a)=>l(t[a].Date)).y0(t=>s(t[0])).y1(t=>s(t[1]))).attr("class","myArea").on("mouseover",c).on("mouseleave",p);let y=20;n.selectAll("legend").data(i).enter().append("rect").attr("x",100).attr("y",(t,e)=>100+e*(y+5)).style("fill",t=>o(t)).attr("width",y).attr("height",y),n.selectAll("labels").data(i).enter().append("text").attr("x",100+1.2*y).attr("y",function(t,e){return 100+e*(y+5)+y/2}).style("fill",function(t){return o(t)}).text(function(t){return t}).attr("text-anchor","left").attr("font-family","Fira Sans").style("alignment-baseline","middle"),n.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",a/2).attr("y",e-r+50).attr("font-size",20).text("Date"),n.append("text").attr("class","y label").attr("font-size",20).attr("text-anchor","middle").attr("x",-e/2).attr("y",0).attr("dy",".75em").attr("transform","rotate(-90)").text("Total Administered Dose"),n.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",a/2).attr("y",r-20).attr("font-size",20).text("Pfizer & Moderna Makeup the Majority of Administered COVID-19 Vaccine AND Vaccination Pace has Slow Down")})},draw_plot4=function(t){let e=t=>({CVAC_level:t["CVAC Level Of Concern"],SVI_cat:t["SVI Category"],fully_vac:parseFloat(t["Percent adults fully vaccinated against COVID-19 (as of 6/10/21)"])});d3.csv(t,e).then(t=>{function e(t,e){let a;d3.select(this).style("stroke-width",10),m.transition().duration(200).style("opacity",.9),console.log(e),a=0!==e.fully_vac?`The Fully Vaxxed Rate: <br> ${e.fully_vac.toFixed(2)}`:"No Data Available for this Category",m.html(a).style("left",t.pageX+"px").style("top",t.pageY-45+"px")}function a(){d3.select(this).transition(),m.transition().duration(200).style("opacity",0)}function r(t){m.style("left",t.pageX+"px").style("top",t.pageY-45+"px")}let n=["Very Low Concern","Low Concern","Moderate Concern","High Concern","Very High Concern"],l=["Very Low Vulnerability","Low Vulnerability","Moderate Vulnerability","High Vulnerability","Very High Vulnerability"],s=d3.rollup(t,t=>t,t=>t.CVAC_level,t=>t.SVI_cat),i=[];n.forEach(t=>{l.forEach(e=>{let a=s.get(t).get(e).map(t=>t.fully_vac),r=0,n=0;a.forEach(t=>{isNaN(t)||(r++,n+=t)}),0===r&&(r=1),i.push({CVAC_level:t,SVI_cat:e,fully_vac:n/r})})}),console.log(i);let o=900,d=900,c=130,p=d3.select("#plot4").append("svg").attr("width",o).attr("height",d),y=d3.scaleBand().range([c,o-c]).domain(n).padding(.03);p.append("g").attr("transform","translate(0,"+(d-c)+")").call(d3.axisBottom(y));let x=d3.scaleBand().range([d-c,c]).domain(l).padding(.03);p.append("g").attr("transform",`translate(${c},0)`).call(d3.axisLeft(x));let h=d3.scaleLinear().range(["white","#69b3a2"]).domain([.2,.6]),m=d3.select("#plot4").append("div").style("opacity",0).attr("class","tooltip").style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px");p.selectAll("square").data(i).enter().append("rect").attr("x",t=>y(t.CVAC_level)).attr("y",t=>x(t.SVI_cat)).attr("width",y.bandwidth()).attr("height",x.bandwidth()).style("fill",function(t){return h(t.fully_vac)}).on("mouseover",e).on("mouseout",a).on("mousemove",r),p.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",y("Very High Concern")+y.bandwidth()/2).attr("y",x("Very Low Vulnerability")+x.bandwidth()/2).text("N/A"),p.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",o/2).attr("y",d-c+50).attr("font-size",20).text("Level of Vaccine Rollout Concern "),p.append("text").attr("class","y label").attr("text-anchor","middle").attr("x",-d/2).attr("y",0).attr("dy",".75em").attr("transform","rotate(-90)").attr("font-size",20).text("Social Vulnerability Index Category"),p.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",o/2).attr("y",c-20).attr("font-size",20).text("High Social Vulnerability Coupled with Low Concern of Vaccine Rollout has High Vaccination Rate")})},draw_plot5=function(t){let e=t=>({SVI_cat:t["SVI Category"],Hesitant:parseFloat(t["Estimated hesitant"])});d3.csv(t,e).then(t=>{console.log(t);let e=["Very Low Vulnerability","Low Vulnerability","Moderate Vulnerability","High Vulnerability","Very High Vulnerability"],a=900,r=900,n=50,l=d3.select("#plot5").append("svg").attr("width",a).attr("height",r),s=d3.scaleBand().range([n,a-n]).domain(e).paddingInner(.2);l.append("g").attr("transform","translate(0,"+(r-n)+")").call(d3.axisBottom(s));let i=d3.scaleLinear().domain([0,.3]).range([r-n,n]);l.append("g").attr("transform",`translate(${n}, 0)`).call(d3.axisLeft(i));let o=t=>{let e=d3.quantile(t.map(function(t){return t.Hesitant}).sort(d3.ascending),.25),a=d3.quantile(t.map(function(t){return t.Hesitant}).sort(d3.ascending),.5),r=d3.quantile(t.map(function(t){return t.Hesitant}).sort(d3.ascending),.75),n=r-e;return{q1:e,median:a,q3:r,interQuantileRange:n,min:e-1.5*n,max:r+1.5*n}},d=d3.rollup(t,o,t=>t.SVI_cat),c=d3.rollup(t,t=>t,t=>t.SVI_cat);c=Array.from(c,([t,e])=>({SVI_cat:t,data:e})),console.log(c),(d=Array.from(d,([t,e])=>({SVI_cat:t,...e}))).pop(),console.log(d),l.selectAll("vertLines").data(d).enter().append("line").attr("x1",t=>s(t.SVI_cat)+s.bandwidth()/2).attr("x2",t=>s(t.SVI_cat)+s.bandwidth()/2).attr("y1",t=>i(t.min)).attr("y2",t=>i(t.max)).attr("stroke","black").style("width",40),l.selectAll("boxes").data(d).enter().append("rect").attr("x",t=>s(t.SVI_cat)).attr("y",t=>i(t.q3)).attr("height",t=>i(t.interQuantileRange)-i(t.q3)).attr("width",s.bandwidth()).attr("stroke","black").style("fill","#7eb0d5").style("opacity",.9),l.selectAll("medianLines").data(d).enter().append("line").attr("x1",t=>s(t.SVI_cat)).attr("x2",t=>s(t.SVI_cat)+s.bandwidth()).attr("y1",t=>i(t.median)).attr("y2",t=>i(t.median)).attr("stroke","black");let p=50;l.selectAll("indPoints").data(t).enter().append("circle").attr("cx",t=>s(t.SVI_cat)+Math.random()*p+s.bandwidth()/2-p/2).attr("cy",t=>i(t.Hesitant)).attr("r",4).style("fill","white").attr("stroke","black").style("opacity",.5),l.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",a/2).attr("y",r-n+50).attr("font-size",20).text("Level of Social Vulnerability"),l.append("text").attr("class","y label").attr("text-anchor","middle").attr("x",-r/2).attr("y",0).attr("dy",".75em").attr("transform","rotate(-90)").attr("font-size",20).text("Hesitancy about take the vaccine"),l.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",a/2).attr("y",n/2).attr("font-size",20).text("High Social Vulnerability Tend to Have Higher Hesitancy Regarding COVID-19 Vaccine")})};